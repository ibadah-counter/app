<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="manifest.webmanifest">
  <title>عداد العبادات</title>

  <style>
    :root{--bg:#0b1220;--card:#111a2b;--txt:#e6edf7;--muted:#9fb1c6}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Arial}
    body{margin:0;background:linear-gradient(180deg,#071023,#0b1220);color:var(--txt);min-height:100vh}
    header{padding:18px 16px 10px;position:sticky;top:0;background:rgba(7,16,35,.9);backdrop-filter:blur(10px)}
    h1{margin:0;font-size:20px}
    .sub{margin-top:6px;font-size:13px;color:var(--muted)}
    main{padding:14px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .card{background:var(--card);border-radius:18px;padding:14px;text-align:center}
    .name{font-size:18px;font-weight:700}
    .badge{font-size:12px;color:var(--muted)}
    .count{font-size:42px;font-weight:800;margin:8px 0}
    .row{display:flex;gap:10px;justify-content:center}
    button{border:none;border-radius:14px;padding:10px 14px;font-size:20px;background:#1e293b;color:#fff}
    button:active{transform:scale(.96)}
    .footer{margin-top:14px;display:flex;gap:10px}
    .danger{background:#7f1d1d}
    .soft{background:#0369a1}
  </style>
</head>

<body>
<header>
  <h1>عداد العبادات</h1>
  <div class="sub">الأيام = أقل عدد بين الصلوات | + للأيام يزيد كل الصلوات</div>
</header>

<main>
  <div class="grid" id="grid"></div>

  <div class="footer">
    <button class="danger" id="resetPrayers">تصفير الصلوات</button>
    <button class="soft" id="resetFasting">تصفير الصيام</button>
  </div>
</main>

<script>
const KEY="ibadah.v1";

const DEFAULT_PRAYERS=[
 {id:"fajr",name:"الفجر",count:0},
 {id:"dhuhr",name:"الظهر",count:0},
 {id:"asr",name:"العصر",count:0},
 {id:"maghrib",name:"المغرب",count:0},
 {id:"isha",name:"العشاء",count:0},
];

function load(){
 try{
  const d=JSON.parse(localStorage.getItem(KEY));
  if(!d) throw 0;
  return d;
 }catch{
  return {prayers:DEFAULT_PRAYERS.map(p=>({...p})),fasting:0};
 }
}
function save(){localStorage.setItem(KEY,JSON.stringify(state));}
function vibrate(){navigator.vibrate?.(15);}

let state=load();
const grid=document.getElementById("grid");

function days(){return Math.min(...state.prayers.map(p=>p.count));}

function render(){
 grid.innerHTML="";

 // days
 grid.innerHTML+=`
 <div class="card">
  <div class="name">الأيام</div>
  <div class="badge">أقل عدد بين الصلوات</div>
  <div class="count">${days()}</div>
  <div class="row">
   <button onclick="daysMinus()">−</button>
   <button onclick="daysPlus()">+</button>
  </div>
 </div>`;

 // prayers
 state.prayers.forEach(p=>{
  grid.innerHTML+=`
  <div class="card">
   <div class="name">${p.name}</div>
   <div class="count">${p.count}</div>
   <div class="row">
    <button onclick="minus('${p.id}')">−</button>
    <button onclick="plus('${p.id}')">+</button>
   </div>
  </div>`;
 });

 // fasting
 grid.innerHTML+=`
 <div class="card">
  <div class="name">الصيام</div>
  <div class="badge">مستقل</div>
  <div class="count">${state.fasting}</div>
  <div class="row">
   <button onclick="fastMinus()">−</button>
   <button onclick="fastPlus()">+</button>
  </div>
 </div>`;
}

function plus(id){vibrate();state.prayers.find(p=>p.id==id).count++;save();render();}
function minus(id){vibrate();let p=state.prayers.find(p=>p.id==id);p.count=Math.max(0,p.count-1);save();render();}
function daysPlus(){vibrate();state.prayers.forEach(p=>p.count++);save();render();}
function daysMinus(){vibrate();state.prayers.forEach(p=>p.count=Math.max(0,p.count-1));save();render();}
function fastPlus(){vibrate();state.fasting++;save();render();}
function fastMinus(){vibrate();state.fasting=Math.max(0,state.fasting-1);save();render();}

document.getElementById("resetPrayers").onclick=()=>{
 if(confirm("تصفير الصلوات؟")){state.prayers.forEach(p=>p.count=0);save();render();}
};
document.getElementById("resetFasting").onclick=()=>{
 if(confirm("تصفير الصيام؟")){state.fasting=0;save();render();}
};

if("serviceWorker"in navigator){
 window.addEventListener("load",()=>navigator.serviceWorker.register("sw.js"));
}

render();
</script>
</body>
</html>
